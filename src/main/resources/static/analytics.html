<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheatreCraft - Search Analytics</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Analytics-specific styles */
        .analytics-container {
            max-width: 1000px;
            margin: 2rem auto;
            padding: 2rem;
        }

        .analytics-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .analytics-header h1 {
            color: #B22234;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .analytics-header p {
            color: #666;
            font-size: 1.1rem;
        }

        .analytics-table {
            width: 100%;
            background-color: #ffffff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .analytics-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .analytics-table thead {
            background-color: #212427;
            color: #ffffff;
        }

        .analytics-table th {
            padding: 1.25rem;
            text-align: left;
            font-weight: bold;
            font-size: 1rem;
            text-transform: uppercase;
        }

        .analytics-table th:first-child {
            text-align: center;
            width: 120px;
        }

        .analytics-table th:last-child {
            text-align: center;
            width: 150px;
        }

        .analytics-table tbody tr {
            border-bottom: 1px solid #e0e0e0;
            transition: background-color 0.2s ease;
        }

        .analytics-table tbody tr:hover {
            background-color: #f5f5f5;
        }

        .analytics-table tbody tr:last-child {
            border-bottom: none;
        }

        .analytics-table td {
            padding: 1rem 1.25rem;
            font-size: 0.95rem;
        }

        .analytics-table .serial-number {
            text-align: center;
            font-weight: bold;
            color: #B22234;
        }

        .analytics-table .product-name {
            color: #212427;
            font-weight: 500;
        }

        .analytics-table .search-count {
            text-align: center;
            font-weight: bold;
            color: #212427;
        }

        .no-data {
            text-align: center;
            padding: 3rem;
            color: #666;
            font-size: 1.1rem;
        }

        .loading-indicator {
            text-align: center;
            padding: 3rem;
            color: #B22234;
            font-size: 1.2rem;
        }

        .refresh-button {
            display: block;
            margin: 2rem auto 0;
            padding: 0.75rem 2rem;
            background-color: #B22234;
            color: #ffffff;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .refresh-button:hover {
            background-color: #8a1a28;
        }

        @media (max-width: 768px) {
            .analytics-container {
                padding: 1rem;
            }

            .analytics-header h1 {
                font-size: 2rem;
            }

            .analytics-table th,
            .analytics-table td {
                padding: 0.75rem 0.5rem;
                font-size: 0.85rem;
            }

            .analytics-table th:first-child,
            .analytics-table th:last-child {
                width: auto;
            }
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">TheatreCraft</div>
            <ul class="nav-links">
                <li><a href="index.html" class="nav-link">Home</a></li>
                <li class="dropdown">
                    <a href="#" class="nav-link active">Analytics â–¾</a>
                    <ul class="dropdown-menu">
                        <li><a href="analytics.html">Top Frequency</a></li>
                        <li><a href="#">Frequency Count</a></li>
                        <li><a href="#">Page Ranking</a></li>
                    </ul>
                </li>
                <li><a href="comparator.html" class="nav-link">Compare</a></li>
                <li><a href="#" class="nav-link">Recommend</a></li>
            </ul>
        </div>
    </nav>

    <!-- ANALYTICS CONTENT -->
    <div class="analytics-container">
        <div class="analytics-header">
            <h1>Top 10 Searched Products</h1>
            <p>Most frequently searched products by users</p>
        </div>

        <div class="analytics-table">
            <table id="analytics-table">
                <thead>
                    <tr>
                        <th>Serial Number</th>
                        <th>Searched Word</th>
                        <th>Search Count</th>
                    </tr>
                </thead>
                <tbody id="analytics-tbody">
                    <!-- Data will be loaded here -->
                </tbody>
            </table>
        </div>

        <button id="refresh-button" class="refresh-button">Refresh Data</button>
    </div>

    <script>
        // Load analytics data on page load
        document.addEventListener("DOMContentLoaded", () => {
            loadAnalyticsData();
            setupRefreshButton();
        });

        async function loadAnalyticsData() {
            const tbody = document.getElementById("analytics-tbody");
            
            try {
                showLoading();
                
                const response = await fetch("/api/search/frequencies?limit=10");
                
                if (!response.ok) {
                    throw new Error("Failed to fetch analytics data");
                }
                
                const data = await response.json();
                
                if (data.length === 0) {
                    showNoData();
                } else {
                    renderAnalyticsTable(data);
                }
                
            } catch (error) {
                console.error("Error loading analytics:", error);
                tbody.innerHTML = '<tr><td colspan="3" class="no-data">Failed to load analytics data. Please try again.</td></tr>';
            }
        }

        function renderAnalyticsTable(data) {
            const tbody = document.getElementById("analytics-tbody");
            
            tbody.innerHTML = data.map((item, index) => `
                <tr>
                    <td class="serial-number">${index + 1}</td>
                    <td class="product-name">${item.searchTerm}</td>
                    <td class="search-count">${item.count}</td>
                </tr>
            `).join('');
        }

        function showLoading() {
            const tbody = document.getElementById("analytics-tbody");
            tbody.innerHTML = '<tr><td colspan="3" class="loading-indicator">Loading analytics data...</td></tr>';
        }

        function showNoData() {
            const tbody = document.getElementById("analytics-tbody");
            tbody.innerHTML = '<tr><td colspan="3" class="no-data">No search data available yet. Start searching for products on the home page!</td></tr>';
        }

        function setupRefreshButton() {
            const refreshButton = document.getElementById("refresh-button");
            
            refreshButton.addEventListener("click", () => {
                loadAnalyticsData();
            });
        }
    </script>

    <!-- FOOTER -->
    <footer class="footer">
        <p>COMP 8547 | Advanced Computing Concepts | Project Group 16</p>
    </footer>
</body>
</html>
